<!DOCTYPE html>
<html>
    <head>
        <title>

            NYC Multilayer Web Map Viz | for DEMO purposes only

        </title>

        <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
        <meta http-equiv="content-type" content="text/html; charset=UTF-8" />

     

       <!-- <link href='https://fonts.googleapis.com/css?family=Work+Sans:400,900' rel='stylesheet' type='text/css'> -->
            <!-- <link rel="stylesheet" href="//cdn.leafletjs.com/leaflet-0.7/leaflet.css"/> -->
            <!--<link rel="stylesheet" href="../cau-clergy/css/leaflet.groupedlayercontrol.css" /> -->

        <link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v3/themes/css/cartodb.css" type="text/css" />
        <link rel="stylesheet" href="css/styledLayerControl.css" />
        <link rel="stylesheet" href="css/instructorStyles.css" />
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">

    <!-- <script src="//cdn.leafletjs.com/leaflet-0.7/leaflet.js"></script> -->
   <!-- <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script> -->
   <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script> -->

  <style type="text/css">
            html, body, #map {
                height: 100%;
                padding: 0;
                margin: 0;
            }

/* style and position the legend  */
    #my-legend {
        position: absolute;
        width: auto;
        padding: 10px;
        float: left;
        bottom: 30px;
        right: 10px;
      }


      .my-legend {
        background: rgba(255,255,255,1);
        background: transparent url(css/images/bgnoise_lg.jpg) repeat top left;
        border-radius: 5px;
        border: 0;
        box-shadow: 0 0 8px rgba(0, 0, 0, 0.9);
        font-family: 'Ubuntu-Regular', Arial, sans-serif;
        font-size: 18px;
        text-shadow: 1px 1px 1px rgba(255,255,255,0.8);
        padding: 5px 5px 5px 5px;  /* top, right, bottom, left  */
        max-height: 200px;
        max-width: 320px;
        overflow-x: hidden;
        overflow-y: scroll;
      }

      .my-legend .legend-title {
        font-family: 'Ubuntu-Regular', Arial, sans-serif;
        /*margin-bottom: 5px;*/
        padding-bottom: 5px;
        font-weight: bold;
        font-size: 155%;
        }

      .my-legend .layer-title {
       font-family: 'BebasNeueRegular', 'Arial Narrow', Arial, sans-serif;
        text-align: left;
        padding-bottom: 1px;
        padding-top: 9px;
        font-weight: bold;
        font-size: 105%;
        }
      .my-legend .legend-scale ul {
        margin: 0;
        padding: 0;
        float: left;
        list-style: none;
        }
      .my-legend .legend-scale ul li {  /* color span and text block area - the li*/
        display: block;
        padding-bottom: 5px;
        float: left;
        width: 40px;
        font-size: 60%;
        text-shadow: none;
        list-style: none;
        }

    /* rotate legend labels*/
      .rotate-text{
        transform: rotate(-50deg);
        transform-origin: left top 5;
      }
      .rotate-text{
        float: left;
        text-align: center;
        padding: 18px 0px 8px 1px;
        font-weight: 600;
      }

      .my-legend ul.legend-labels li span {
        display: block;
        float: left;
        height: 20px;  /* height & width of the span blocks in pixels */
        width: 40px;
        }
      .my-legend .legend-source {
        font-size: 55%;
        font-style: italic;
        text-align: right;
        color: #999;
        clear: both;
        margin-bottom: 3px;
        }
      .my-legend a {
        color: #2b8cbe;
        }


        /* vertical legend style for DOE data*/
          .my-legend .legend-scale-2 ul {
              margin: 0;
              margin-bottom: 0;
              padding: 0;
              float: left;
              list-style: none;
              }
          .my-legend .legend-scale-2 ul li {
              font-size: 70%;
              list-style: none;
              text-shadow: none;
              margin-left: 0px;
              margin-right: 1px;
              line-height: 15px;
              margin-bottom: 1px;
              }
          .my-legend ul.legend-labels-2 li span {
              display: block;
              float: left;
              height: 15px;
              width: 18px;
              margin-right: 2px;
              margin-left: 2px;
              border: 0px solid #fff;
              }

/* change the appearance of the leaflet zoom control, copied from http://wcfcourier.com/app/special/fatalcrashes/css/styles.css */
      .leaflet-control-zoom a {
          background-color: #C5E1EB;
          color: #000;
          text-decoration: none;
      }

      .leaflet-bar a:hover {
          background-color: #000;
      }

      .leaflet-control-zoom a:hover {
          background-color: #000;
          color: #CCC;
          text-decoration: none;
      }

      .leaflet-control-zoom a.leaflet-disabled {
          background-color: #999;
        color: #BBB;
      }

      .leaflet-control-zoom a.leaflet-disabled:hover {
          color: #BBB;
      }


      </style>
    </head>

    <body>
        <div id="map"></div>

<!-- code for "instructions" (legend) from  http://wcfcourier.com/app/special/fatalcrashes/ -->
<div id="hide_show_instructor">
    <div class="show_instructor" >
      <div class="icon-sort-up"></div> <i class="fa fa-chevron-up"></i>
      <div class="hide_show_instructor_text">instructions</div>
    </div>
    <div class="hide_instructor" style="display: none;">
      <div class="icon-sort-down"></div> <i class="fa fa-chevron-down"></i>
      <div class="hide_show_instructor_text">Hide</div>
    </div>
  </div>

    <div id="instructor" class="box-shadow">
      <h1>CAU Outreach Map</h1>

      <div id="instructor-text-intro">
        <p>Layers are drawn as you select them, newest on top of oldest. To change the order, simply toggle a layer off and then on again to make it appear on top of others.</p>
      </div>
   </div>


<!--   MAPBOX-style LEGEND  - framwork from SCHLANG map -->

<div id='my-legend' class='my-legend'>

<!-- <div class='legend-title'></div>
<hr style="background:#000; border:0; height:2px" /> -->
<div class='layer-title'>Race, Ethnicity & Foreign Born Layers</div>
<div class='legend-scale'>
  <ul class='legend-labels'>
    <li><span style='background:#FFFFB2;'></span><span class="rotate-text">10-19%</span></li>
    <li><span style='background:#FED976;'></span><span class="rotate-text">20-34%</span></li>
    <li><span style='background:#FEB24C;'></span><span class="rotate-text">35-49%</span></li>
    <li><span style='background:#FD8D3C;'></span><span class="rotate-text">50-64%</span></li>
    <li><span style='background:#FC4E2A;'></span><span class="rotate-text">65-79%</span></li>
    <li><span style='background:#E31A1C;'></span><span class="rotate-text">80-89%</span></li>
    <li><span style='background:#B10026;'></span><span class="rotate-text">90+ %</span></li>
  </ul>

</div>
<div class='legend-source'>Source: 2012 <a href="https://www.census.gov/programs-surveys/acs/">American Community Survey</a></div>

<hr style="background:#c0c0c0; border:0; height:2px" />

  <div class='layer-title'>Median HH Income</div>
  <div class='legend-scale'>
    <ul class='legend-labels'>
      <li><span style='background:#d73027;'></span><span class="rotate-text">$30,000</li>
      <li><span style='background:#f79272;'></span><span class="rotate-text">$39,000</li>
      <li><span style='background:#fed6b0;'></span><span class="rotate-text">$48,000</li>
      <li><span style='background:#fff2cc;'></span><span class="rotate-text">$57,000</li>
      <li><span style='background:#d2ecb4;'></span><span class="rotate-text">$67,000</li>
      <li><span style='background:#8cce8a;'></span><span class="rotate-text">$84,000</li>
      <li><span style='background:#1a9850;'></span><span class="rotate-text">$244,000</li>
    </ul>
  </div>
<div class='legend-source'>Source: 2012 <a href="https://www.census.gov/programs-surveys/acs/">American Community Survey</a></div>

<hr style="background:#c0c0c0; border:0; height:2px" />

  <div class='layer-title'>Median Income to Rent</div>
  <div class='legend-scale'>
    <ul class='legend-labels'>
      <li><span style='background:#0080ff;'></span><span class="rotate-text"> 22-25% </li>
     <li><span style='background:#40a0ff;'></span><span class="rotate-text"> 26-31% </li>
      <li><span style='background:#7fbfff;'></span><span class="rotate-text"> 31-35% </li>
      <li><span style='background:#fff2cc;'></span><span class="rotate-text"> 36-40% </li>
      <li><span style='background:#ffa6a6;'></span><span class="rotate-text"> 40-44% </li>
      <li><span style='background:#ff7a7a;'></span><span class="rotate-text"> 45-50% </li>
      <li><span style='background:#ff4d4d;'></span><span class="rotate-text"> 50+ % </li>
    </ul>
  </div>
     


  </div>
<!-- load infowindow template -->
<script type="infowindow/html" id="infowindow_template">
      <span> custom </span>
      <div class="cartodb-popup">
        <a href="#close" class="cartodb-popup-close-button close">x</a>
         <div class="cartodb-popup-content-wrapper">
           <div class="cartodb-popup-content">
           <h4 style="position:absolute; top:12px; left:19px; right:21px; display:block; width:auto; padding:8px; text-align:center; color:white; background:rgba(0,0,0,0.7)"> {{content.data.name}}</h4>
             /* content.data contains the field info */

           </div>
         </div>
         <div class="cartodb-popup-tip-container"></div>
      </div>
    </script>
        <!-- include cartodb.js library -->
        <script src="http://libs.cartocdn.com/cartodb.js/v3/3.15/cartodb.js" type="text/javascript"></script>
        <script src="src/styledLayerControl.js"></script>
        <!-- <script src="../cau-clergy/src/leaflet.groupedlayercontrol.js"></script> -->


        <!--[if lte IE 8]>
        <link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v2/themes/css/cartodb.ie.css" />
        <![endif]-->


 <script>
// Toggle for show, hide instructions
// Only visible on desktop
isHideButton = false;
$('#hide_show_instructor').click(function() {
  // console.log(isHideButton);
  if (isHideButton === true) {
    $('.hide_instructor').hide();
    $('.show_instructor').show();
    $('#instructor').slideUp();
    $('#hide_show_instructor').removeClass('box-shadow');
    $('.hide_show_instructor').show();
    isHideButton = false;
  } else {
    $('.show_instructor').hide();
    $('.hide_instructor').show();
    $('#instructor').slideDown();
    $('#hide_show_instructor').addClass('box-shadow');
    $('.hide_show_instructor').show();
    isHideButton = true;
  }
});
</script>

        <script type="text/javascript">
            window.onload = function () {

              //load up basemaps, store in var objects
              var light_nolabels = L.tileLayer('http://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}.png', {attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'});

              var Esri_WorldImagery = L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {attribution: 'Tiles &copy; Esri &mdash; Source: Esri et. al.'});

              var OpenStreetMap_Mapnik = L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {maxZoom: 19, attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'});

              var Stamen_TerrainBackground = L.tileLayer('http://stamen-tiles-{s}.a.ssl.fastly.net/terrain-background/{z}/{x}/{y}.png', {
                attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',  subdomains: 'abcd',  minZoom: 4,  maxZoom: 18,  ext: 'png',  bounds: [[22, -132], [70, -56]] });

              var black_wallpaper = L.tileLayer('http://www.colourlovers.com/wallPaper/1200x800/n/2875/COLOURlovers.com-Gothic_Wallpaper.png', { attribution: '&copy; <a href="http://www.colourlovers.com/lover/candycrack/loveNote">CandyCrack</a> contributors'});

              var Acetate_terrain = L.tileLayer('http://a{s}.acetate.geoiq.com/tiles/terrain/{z}/{x}/{y}.png', {
                    attribution: '&copy;2012 Esri & Stamen, Data from OSM and Natural Earth',
                    subdomains: '0123',
                    minZoom: 2,
                    maxZoom: 18
                  });

              var MapQuestOpen_OSM = L.tileLayer('http://otile{s}.mqcdn.com/tiles/1.0.0/{type}/{z}/{x}/{y}.{ext}', {
                type: 'map',
                ext: 'jpg',
                attribution: 'Tiles Courtesy of <a href="http://www.mapquest.com/">MapQuest</a> &mdash; Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
                subdomains: '1234'
              });

                // Instantiate new map object, place it in 'map' element
              var map_object = new L.Map('map', {
                    center: [40.7033,-73.9796], // New York, NY
                    zoomControl: false,   // remove default zoomControl position to create a custom one
                    zoom: 11,
                    maxZoom: 16,
                    minZoom: 10,
                    layers:[light_nolabels]    // initial basemap
                    //scrollWheelZoom: false   // to keep from zooming accidentally
              });

              map_object.addControl( L.control.zoom({position: 'topright'}) );      //add custom zoom controller and position


// FROM: javisantana’s block #8313604 -- January 8, 2014 -- http://bl.ocks.org/javisantana/8313604
              var polygons = {};

        function geometryHover(username, map, layer, options) {
          options = options || {}
          var HIGHLIGHT_STYLE = {
            weight: 3,
            color: '#FF0',
            opacity: 1,
            fillColor: '#FF0',
            fillOpacity: 0.3
          };
          style = options.style || HIGHLIGHT_STYLE;
          var polygonsHighlighted = [];

          // fetch the geometry   (changed ST_Simplify value from 0.1)
          var sql = new cartodb.SQL({ user: username, format: 'geojson' });
          sql.execute("select cartodb_id, ST_Simplify(the_geom, 0.00001) as the_geom from (" + layer.getSQL() + ") as _wrap").done(function(geojson) {
            var features = geojson.features;
            for(var i = 0; i < features.length; ++i) {
              var f = geojson.features[i];
              var key = f.properties.cartodb_id

              // generate geometry
              var geo = L.GeoJSON.geometryToLayer(features[i].geometry);
              geo.setStyle(style);

              // add to polygons
              polygons[key] = polygons[key] ||  [];
              polygons[key].push(geo);
            }
          });

          function featureOver(e, pos, latlng, data) {
            featureOut();
            var pol = polygons[data.cartodb_id] || [];
            for(var i = 0; i < pol.length; ++i) {
              map_object.addLayer(pol[i]);
              polygonsHighlighted.push(pol[i]);
            }
          }

          function featureOut() {
            var pol = polygonsHighlighted;
            for(var i = 0; i < pol.length; ++i) {
              map_object.removeLayer(pol[i]);
            }
            polygonsHighlighted = [];
          }

          layer.on('featureOver', featureOver);
          layer.on('featureOut', featureOut);
          layer.setInteraction(true);

        }

// </ end of javisantana’s geometryhover block

// ***********************************************************************
// Leaflet BOUNDARY overlays using cartodb.createLayer and .addTo() method

var labels_overlay = L.tileLayer('http://{s}.basemaps.cartocdn.com/light_only_labels/{z}/{x}/{y}.png', {attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'});
    var l_labels_overlay = new L.LayerGroup();
    labels_overlay.addTo(l_labels_overlay).setZIndex(100);  // high Z - to keep on top of all other layers

var Stamen_TonerLabels = L.tileLayer('http://stamen-tiles-{s}.a.ssl.fastly.net/toner-labels/{z}/{x}/{y}.png', {  attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>', subdomains: 'abcd', minZoom: 0,  maxZoom: 20,  ext: 'png'});

var neighborhoods = cartodb.createLayer(map_object, {
                    user_name: 'andrewmartini',
                    type: 'cartodb',
                    sublayers: [{
                      sql: "SELECT * FROM neighborhoods",
                      cartocss: "#layer { polygon-fill: #000000; polygon-opacity: 0; ::case {line-color: #FFFFFF; line-width: 3; line-opacity: 1;}  ::fill {line-color: #928d8d; line-width: 2; line-opacity: 1; }}",
                      interactivity: "cartodb_id" }]
                    });
    var l_neighborhoods = new L.LayerGroup();
    neighborhoods.addTo(l_neighborhoods);

 var neigh_labels = cartodb.createLayer(map_object, {
                    user_name: 'andrewmartini',
                    type: 'cartodb',
                    sublayers: [{
                      sql: "SELECT * FROM neighborhoods",
                      cartocss: "Map{buffer-size:512;} #layer::labels [zoom >=11]{ polygon-fill: #fff; polygon-opacity: 0; line-width: 0; line-opacity: 0;  text-name: [ntaname3];  text-face-name: 'Lato Bold';  text-size: 9;  text-fill: #333333;  text-opacity: 0.8;  text-halo-fill: #FFF;  text-halo-radius: 1.5;  text-transform: uppercase;  text-wrap-width: 50;  text-wrap-before: true; text-character-spacing: 1.1;  text-allow-overlap:false;  text-placement-type: simple;  text-placements: 'W,E,N,S,8,6';  text-label-position-tolerance:55;  text-min-distance:10; } #layer::labels [zoom >=13]{ polygon-fill: #fff; polygon-opacity: 0; line-width: 0; line-opacity: 0;  text-name: [ntaname3];  text-face-name: 'Lato Bold';  text-size: 12;  text-fill: #333333;  text-opacity: 0.8;  text-halo-fill: #FFF;  text-halo-radius: 1.5;  text-transform: uppercase;  text-wrap-width: 80;  text-wrap-before: true; text-character-spacing: 1.3;  text-allow-overlap:false;  text-placement-type: simple;  text-placements: 'W,E,N,S,11,10';  text-label-position-tolerance:5;  text-min-distance:10; }",
                      interactivity: "cartodb_id" }]
                    });
    var l_neigh_labels = new L.LayerGroup();
    neigh_labels.addTo(l_neigh_labels);


var nycc = cartodb.createLayer(map_object, {
                    user_name: 'andrewmartini',
                    type: 'cartodb',
                    sublayers: [{
                      sql: "SELECT * FROM nycc",
                      cartocss: "#layer{ polygon-fill: #000000; polygon-opacity: 0; ::case {line-color: #FFFFFF; line-width: 6; line-opacity: 1;}  ::fill {line-color: #FF2900; line-width: 4; line-opacity: 1; } } #nycc::labels [zoom >= 12]{   text-name: 'CC '+[coundist];   text-face-name: 'Lato Bold';   text-size: 16;   text-label-position-tolerance: 10;  text-character-spacing: 1.3; text-fill: #FF2900;   text-halo-fill: #FFF;   text-halo-radius: 1.5;   text-dy: 0;   text-allow-overlap: false;   text-placement: interior;   text-placement-type: simple;}",
                      interactivity: "cartodb_id"}]
                  });
      var l_nycc = new L.LayerGroup();
      nycc.addTo(l_nycc);

var nycd = cartodb.createLayer(map_object, {
                    user_name: 'andrewmartini',
                    type: 'cartodb',
                    sublayers: [{
                      sql: "SELECT * FROM nycd_append",
                      cartocss: "#layer { polygon-fill: #000000; polygon-opacity: 0; ::case {line-color: #FFFFFF; line-width: 6; line-opacity: 1;}  ::fill {line-color: #000000; line-width: 3; line-opacity: 1; }  } #nycd::labels [zoom >= 12]{   text-name: [b_name]+' '+[dist_num];   text-face-name: 'Lato Bold';   text-size: 14;   text-label-position-tolerance: 10;  text-character-spacing: 1.3; text-fill: #000;   text-halo-fill: #FFF;   text-halo-radius: 1.5;   text-dy: 10;   text-allow-overlap: false;   text-placement: interior;   text-placement-type: simple;}",
                      interactivity: "cartodb_id"}]
                  });
      var l_nycd = new L.LayerGroup();
      nycd.addTo(l_nycd);

var nyss = cartodb.createLayer(map_object, {
                    user_name: 'andrewmartini',
                    type: 'cartodb',
                    sublayers: [{
                      sql: "SELECT * FROM nyss WHERE stsendist is not null",
                      cartocss: "#layer { polygon-fill: #000000; polygon-opacity: 0; ::case {line-color: #FFFFFF; line-width: 6; line-opacity: 1;}  ::fill {line-color: #800080; line-width: 3; line-opacity: 1; }  } #nyss::labels [zoom >= 12]{   text-name: 'SS '+[stsendist];   text-face-name: 'Lato Bold';   text-size: 16;   text-label-position-tolerance: 10;  text-character-spacing: 1.3; text-fill: #800080;   text-halo-fill: #FFF;   text-halo-radius: 1.5;   text-dy: 0;   text-allow-overlap: false;   text-placement: interior;   text-placement-type: simple;}",
                      interactivity: "cartodb_id"}]
                  });
      var l_nyss = new L.LayerGroup();
      nyss.addTo(l_nyss);

var nyad = cartodb.createLayer(map_object, {
                    user_name: 'andrewmartini',
                    type: 'cartodb',
                    sublayers: [{
                      sql: "SELECT * FROM nyad WHERE assemdist is not null",
                      cartocss: "#layer { polygon-fill: #000; polygon-opacity: 0; ::case {line-color: #FFFFFF; line-width: 6; line-opacity: 1;}  ::fill {line-color: #191970; line-width: 3; line-opacity: 1; } } #nyad::labels [zoom >= 12]{   text-name: 'AD '+[assemdist];   text-face-name: 'Lato Bold';   text-size: 16;   text-label-position-tolerance: 10;  text-character-spacing: 1.3; text-fill: #191970;   text-halo-fill: #FFF;   text-halo-radius: 1.5;   text-dy: 0;   text-allow-overlap: false;   text-placement: interior;   text-placement-type: simple;}",
                      interactivity: "cartodb_id"}]
                  });
      var l_nyad = new L.LayerGroup();
      nyad.addTo(l_nyad);

var nycg = cartodb.createLayer(map_object, {
                    user_name: 'andrewmartini',
                    type: 'cartodb',
                    sublayers: [{
                      sql: "SELECT * FROM nycg WHERE congdist is not null",
                      cartocss: "#layer { polygon-fill: #000; polygon-opacity: 0;  ::case {line-color: #FFFFFF; line-width: 6; line-opacity: 1;}  ::fill {line-color: #B22222; line-width: 3; line-opacity: 1; } } #nycg::labels [zoom >= 12]{   text-name: 'CG '+[congdist];   text-face-name: 'Lato Bold';   text-size: 16;   text-label-position-tolerance: 10;  text-character-spacing: 1.3; text-fill: #B22222;   text-halo-fill: #FFF;   text-halo-radius: 1.5;   text-dy: 10;   text-allow-overlap: false;   text-placement: interior;   text-placement-type: simple;}",
                      interactivity: "cartodb_id"}]
                  });
      var l_nycg = new L.LayerGroup();
      nycg.addTo(l_nycg);

var nybb = cartodb.createLayer(map_object, {
                    user_name: 'andrewmartini',
                    type: 'cartodb',
                    sublayers: [{
                        sql: "SELECT * FROM nybb",
                        cartocss: "#layer { polygon-fill: #636363;  polygon-opacity: 0;  ::case {line-color: #FFFFFF; line-width: 5; line-opacity: 1;}  ::fill { line-color: #636363; line-width: 3; line-opacity: 1; } }",
                        interactivity: "cartodb_id"}]
                        });
      var l_nybb = new L.LayerGroup();
      nybb.addTo(l_nybb);

 var zipcode = cartodb.createLayer(map_object, {
                    user_name: 'andrewmartini',
                    type: 'cartodb',
                    sublayers: [{
                        sql: "SELECT * FROM nyc_zipcode_2014_edit",
                        cartocss: "#layer {   polygon-fill: #FFF;   polygon-opacity: 0;   ::case {line-color: #fff; line-width: 6; line-opacity: 1;}  ::fill { line-color: #636363; line-width: 2.5; line-opacity: 1; line-cap: round; line-dasharray: 4, 4; }}   #nyc_zipcode_2014_edit::labels [zoom >12]{   text-name: [postal];   text-face-name: 'Lato Bold';   text-size: 14;   text-label-position-tolerance: 10;   text-fill: #000;   text-halo-fill: #FFF;   text-halo-radius: 1;   text-dy: 0;   text-allow-overlap: false;   text-placement: interior;   text-placement-type: simple; } ",
                        interactivity: "cartodb_id"}]
                        });
      var l_zipcode = new L.LayerGroup();
      zipcode.addTo(l_zipcode);

var precincts = cartodb.createLayer(map_object, 'https://ashron24.cartodb.com/api/v2/viz/2fe813da-3d35-11e5-8497-0e0c41326911/viz.json');
      var l_precincts = new L.LayerGroup();
      precincts.addTo(l_precincts);

var uhf_health = cartodb.createLayer(map_object, {
                    user_name: 'andrewmartini',
                    type: 'cartodb',
                    sublayers: [{
                        sql: "SELECT * FROM chs_2009_dohmh_2010b",
                        cartocss: "#layer  {   polygon-fill: #FFf;   polygon-opacity: 0;   ::case {line-color: #FFFFFF; line-width: 6; line-opacity: 1;}  ::fill {line-color: #000; line-width: 3; line-opacity: 1;  }}  #chs_2009_dohmh_2010b::labels [zoom > 12] {   text-name: 'UHF: '+ [first_uhf_];   text-face-name: 'Lato Regular';   text-size: 12;   text-label-position-tolerance: 0;   text-fill: #000;   text-halo-fill: #FFF;   text-halo-radius: 1;   text-dy: 0;   text-allow-overlap: true;   text-placement: interior;   text-placement-type: dummy; }",
                        interactivity: "cartodb_id"}]
                      });
      var l_uhf_health = new L.LayerGroup();
      uhf_health.addTo(l_uhf_health)
          .on('done', function(layer) {
          cdb.vis.Vis.addInfowindow(map_object, layer.getSubLayer(0), [ 'cartodb_id'])
         });


// **********************************************************************************
//  Religious and CBO LAYERS

var cbo = cartodb.createLayer(map_object, 'https://nycdoitt.cartodb.com/u/asherross/api/v2/viz/68dd2cbe-5b14-11e5-8bb4-0ec6f7c8b2b9/viz.json');
    var l_cbo = new L.LayerGroup();
    cbo.addTo(l_cbo);

var schools = cartodb.createLayer(map_object, 'https://nycdoitt.cartodb.com/u/asherross/api/v2/viz/400b696a-6d0a-11e5-9e4e-0e787de82d45/viz.json');
    var l_schools = new L.LayerGroup();
    schools.addTo(l_schools);

var health = cartodb.createLayer(map_object, {  //hospitals and clinics
                    user_name: 'ashron2224',
                    type: 'cartodb',
                    sublayers: [{
                      sql: "SELECT cartodb_id, the_geom_webmercator, facname, facaddress, facility_t, group_type, subgroup_t, capacity, capacity_t, agency_ope, agency_ove, factype FROM fac15 ",
                      cartocss: "#layer [factype>3100][factype<3200][zoom >= 10] {marker-width: 6; marker-file: url(https://s3.amazonaws.com/com.cartodb.users-assets.production/production/ashron24/assets/20150707191228Hospital_Sign_Silhouette_32.png); marker-line-color: #FFFFFF; marker-placement: point; marker-type: ellipse;  marker-allow-overlap: true; }  #layer  [factype>3100][factype<3200][zoom >= 11] { marker-width: 9; } #layer [factype>3100][factype<3200][zoom >= 12]{marker-width: 12; } #layer  [factype>3100][factype<3200] [zoom >= 13]{   marker-width: 18; } #layer  [factype>3100][factype<3200] [zoom >= 15]{ marker-width: 24; }",
                      interactivity: "cartodb_id"}]
                  });
    var l_health = new L.LayerGroup();
    health.addTo(l_health)
          .on('done', function(layer) {
          cdb.vis.Vis.addInfowindow(map_object, layer.getSubLayer(0), ['facname', 'facaddress', 'facility_t', 'group_type', 'subgroup_t', 'capacity', 'capacity_t', 'agency_ope', 'agency_ove'])
   /*      }).on('error', function() {
      console.log("some error occurred" + err);//log the error
       alert("some error occurred: " + err);*/
         });

var library = cartodb.createLayer(map_object, {
                    user_name: 'ashron2224',
                    type: 'cartodb',
                    sublayers: [{
                      sql: "SELECT cartodb_id, the_geom_webmercator, facname, facaddress, facility_t, group_type, subgroup_t, capacity, capacity_t, agency_ope, agency_ove, factype FROM fac15 ",
                      cartocss: "#layer [factype>1400][factype<1403][zoom >= 10] {marker-width: 6;marker-file: url(https://s3.amazonaws.com/com.cartodb.users-assets.production/production/ashron24/assets/20150707192220Open_book_32.png); marker-line-color: #FFFFFF; marker-placement: point; marker-type: ellipse;  marker-allow-overlap: true; }  #layer  [factype>1400][factype<1403][zoom >= 11] { marker-width: 9; } #layer [factype>1400][factype<1403][zoom >= 12]{marker-width: 12; } #layer   [factype>1400][factype<1403][zoom >= 13]{   marker-width: 18; } #layer   [factype>1400][factype<1403][zoom >= 15]{ marker-width: 24; }",
                      interactivity: "cartodb_id"}]
                  });
    var l_library = new L.LayerGroup();
    library.addTo(l_library)
          .on('done', function(layer) {
          cdb.vis.Vis.addInfowindow(map_object, layer.getSubLayer(0), ['facname', 'facaddress', 'facility_t', 'group_type', 'subgroup_t', 'capacity', 'capacity_t', 'agency_ope', 'agency_ove'])
         });

var fac = cartodb.createLayer(map_object, {
                    user_name: 'ashron24',
                    type: 'cartodb',
                    sublayers: [{
                      sql: "SELECT cartodb_id, the_geom_webmercator, name, label FROM scrieloc2_1 ",
                      cartocss: "#layer [label='Fac'][zoom >= 10] {marker-width: 7; marker-file: url(https://s3.amazonaws.com/com.cartodb.users-assets.production/production/ashron24/assets/20150707192143Swimming_silhouette_32.png); marker-line-color: #FFFFFF; marker-placement: point; marker-type: ellipse;  marker-allow-overlap: true; }  #layer  [label='Fac'] [zoom >= 11] { marker-width: 10; } #layer [label='Fac'][zoom >= 12]{marker-width: 13; } #layer  [label='Fac'] [zoom >= 13]{   marker-width: 19; } #layer  [label='Fac'] [zoom >= 15]{ marker-width: 25; }",
                      interactivity: "cartodb_id"}]
                  });
    var l_fac = new L.LayerGroup();
    fac.addTo(l_fac)
          .on('done', function(layer) {
          cdb.vis.Vis.addInfowindow(map_object, layer.getSubLayer(0), [ 'name', 'cartodb_id'])
         });


var nycha = cartodb.createLayer(map_object, {
            user_name: 'andrewmartini',
            type: 'cartodb',
            sublayers: [{
               sql: 'SELECT * FROM nycha_developments_july2011',
               cartocss: "#layer{    polygon-fill: #0700ff;    polygon-opacity: 0.9;    line-color: #FFF;    line-width: 0;    line-opacity: 0;  }    #nycha_developments_july2011::labels [zoom >= 12] [tot_pop11 > 4000] {    text-name: [developmen];    text-face-name: 'Lato Bold';    text-size: 10;    text-label-position-tolerance: 10;    text-fill: #11002F;    text-halo-fill: #FFF;    text-halo-radius: 1;    text-dy: 0;    text-wrap-width: 120;    text-wrap-before: true;    text-character-spacing: 1.5;    text-allow-overlap: false;    text-placement: point;    text-placement-type: simple;    }    #nycha_developments_july2011::labels [zoom >= 13] [tot_pop11 > 1000] {    text-name: [developmen];    text-face-name: 'DejaVu Sans Book';    text-size: 10;    text-label-position-tolerance: 10;    text-fill: #000;    text-halo-fill: #FFF;    text-halo-radius: 1;    text-dy: 0;    text-wrap-width: 150;    text-wrap-before: true;    text-character-spacing: 2;    text-allow-overlap: false;    text-placement: point;    text-placement-type: simple;    }    #nycha_developments_july2011::labels [zoom >= 14] [tot_pop11 > 500] {    text-name: [developmen];    text-face-name: 'DejaVu Sans Book';    text-size: 11;    text-label-position-tolerance: 10;    text-fill: #000;    text-halo-fill: #FFF;    text-halo-radius: 1;    text-dy: 0;    text-wrap-width: 160;    text-wrap-before: true;    text-character-spacing: 2;    text-allow-overlap: false;    text-placement: point;    text-placement-type: simple;    }    #nycha_developments_july2011::labels [zoom >= 15] [tot_pop11 > 100] {    text-name: [developmen];    text-face-name: 'DejaVu Sans Book';    text-size: 12;    text-label-position-tolerance: 10;    text-fill: #000;    text-halo-fill: #FFF;    text-halo-radius: 1;    text-dy: 0;    text-wrap-width: 200;    text-wrap-before: true;    text-character-spacing: 2;    text-allow-overlap: false;    text-placement: point;    text-placement-type: simple;    }    #nycha_developments_july2011::labels [zoom >= 15] [tot_pop11 > 100] {    text-name: [developmen];    text-face-name: 'DejaVu Sans Book';    text-size: 12;    text-label-position-tolerance: 10;    text-fill: #000;    text-halo-fill: #FFF;    text-halo-radius: 1;      }    #nycha_developments_july2011::labels [zoom >= 16] {    text-name: [developmen];    text-face-name: 'DejaVu Sans Book';    text-size: 12;    text-label-position-tolerance: 10;    text-fill: #000;    text-halo-fill: #FFF;    text-halo-radius: 1;    text-dy: 0;    text-wrap-width: 200;    text-wrap-before: true;    text-character-spacing: 2;    text-allow-overlap: false;    text-placement: point;    text-placement-type: simple;    } ",
               interactivity: 'cartodb_id'}]
          });
         var l_nycha = new L.LayerGroup();
         nycha.addTo(l_nycha)
           .on('done', function(layer) {
          cdb.vis.Vis.addInfowindow(map_object, layer.getSubLayer(0), [ 'developmen', 'tot_pop11', 'cartodb_id'])
         });

  var subways = cartodb.createLayer(map_object, 'https://andrewmartini.cartodb.com/api/v2/viz/77a3e3a4-2aaf-11e5-8077-0e9d821ea90d/viz.json');
          var l_subways = new L.LayerGroup();
          subways.addTo(l_subways);

  var dpr_parks = cartodb.createLayer(map_object, 'https://andrewmartini.cartodb.com/api/v2/viz/14265a74-4129-11e5-a71a-0e4fddd5de28/viz.json');
          var l_dpr_parks = new L.LayerGroup();
          dpr_parks.addTo(l_dpr_parks);


/* var none = cartodb.createLayer(map_object, {    // dummy placeholder for "none" value for exclusive groups to 'deselect'
                      user_name: 'andrewmartini',
                      type: 'cartodb',
                      sublayers: [{
                        sql: "SELECT cartodb_id, the_geom_webmercator FROM nybb",
                        cartocss: "#layer{   polygon-fill: #fff;   polygon-opacity: 0;   line-color: #FFF;   line-width: 0;   line-opacity: 0; }",
                      interactivity: "cartodb_id"}]
                    });
    var l_none = new L.LayerGroup();
    none.addTo(l_none); */

var percent_nhblack_choro = cartodb.createLayer(map_object, {
                      user_name: 'andrewmartini',
                      type: 'cartodb',
                      sublayers: [{
                        sql: "SELECT cartodb_id, totalpop, nhblack, the_geom, the_geom_webmercator, (nhblack/totalpop)*100 AS percent_black_12 FROM tract12 WHERE totalpop > 100",
                        cartocss: "#layer{  polygon-fill: #fff;   polygon-opacity: 0;   line-color: #FFF;   line-width: 0;   line-opacity: 0; } #layer [ percent_black_12 >= 10] {    polygon-fill: #FFFFB2;    polygon-opacity: 0.8;   line-color: #FFF;   line-width: 0.1;   line-opacity: 1; } #layer [ percent_black_12 >= 20] {    polygon-fill: #FED976; } #layer [ percent_black_12 >= 35] {    polygon-fill: #FEB24C; } #layer [ percent_black_12 >= 50] {    polygon-fill: #FD8D3C; } #layer [ percent_black_12 >= 65] {    polygon-fill: #FC4E2A; } #layer [ percent_black_12 >= 80] {    polygon-fill: #E31A1C; } #layer [ percent_black_12 >= 90] {    polygon-fill: #B10026; }",
                      interactivity: "cartodb_id"}]
                    });
    var l_percent_nhblack_choro_12 = new L.LayerGroup();
    percent_nhblack_choro.addTo(l_percent_nhblack_choro_12)
        .on('done', function(layer) {
        cdb.vis.Vis.addInfowindow(map_object, layer.getSubLayer(0), ['percent_black_12', 'nhblack', 'totalpop', 'cartodb_id'])
        });


var percent_nhwhite_choro = cartodb.createLayer(map_object, {
                      user_name: 'andrewmartini',
                      type: 'cartodb',
                      sublayers: [{
                        sql: "SELECT cartodb_id, totalpop, nhwhite, the_geom, the_geom_webmercator, (nhwhite/totalpop)*100 as percent_white_12 FROM tract12 where totalpop > 100",
                        cartocss: "#layer{  polygon-fill: #fff;   polygon-opacity: 0;   line-color: #FFF;   line-width: 0;   line-opacity: 0; } #layer [ percent_white_12 >= 10] {    polygon-fill: #FFFFB2;    polygon-opacity: 0.8;   line-color: #FFF;   line-width: 0.1;   line-opacity: 1; } #layer [ percent_white_12 >= 20] {    polygon-fill: #FED976; } #layer [ percent_white_12 >= 35] {    polygon-fill: #FEB24C; } #layer [ percent_white_12 >= 50] {    polygon-fill: #FD8D3C; } #layer [ percent_white_12 >= 65] {    polygon-fill: #FC4E2A; } #layer [ percent_white_12 >= 80] {    polygon-fill: #E31A1C; } #layer [ percent_white_12 >= 90] {    polygon-fill: #B10026; }",
                      interactivity: "cartodb_id"}]
                    });
    var l_percent_nhwhite_choro_12 = new L.LayerGroup();
    percent_nhwhite_choro.addTo(l_percent_nhwhite_choro_12)
          .on('done', function(layer) {
          cdb.vis.Vis.addInfowindow(map_object, layer.getSubLayer(0), ['percent_white_12', 'nhwhite', 'totalpop','cartodb_id'])
         });

var percent_foreignborn_choro = cartodb.createLayer(map_object, {
                      user_name: 'andrewmartini',
                      type: 'cartodb',
                      sublayers: [{
                        sql: "SELECT totalpop, foreignbor, cartodb_id, the_geom, the_geom_webmercator, (foreignbor/totalpop)*100 AS percent_fb_12 FROM tract12 where totalpop > 100",
                        cartocss: "#layer{  polygon-fill: #fff;   polygon-opacity: 0;   line-color: #FFF;   line-width: 0;   line-opacity: 0; } #layer [ percent_fb_12 >= 10] {    polygon-fill: #FFFFB2;    polygon-opacity: 0.8;   line-color: #FFF;   line-width: 0.1;   line-opacity: 1; } #layer [ percent_fb_12 >= 20] {    polygon-fill: #FED976; } #layer [ percent_fb_12 >= 35] {    polygon-fill: #FEB24C; } #layer [ percent_fb_12 >= 50] {    polygon-fill: #FD8D3C; } #layer [ percent_fb_12 >= 65] {    polygon-fill: #FC4E2A; } #layer [ percent_fb_12 >= 80] {    polygon-fill: #E31A1C; } #layer [ percent_fb_12 >= 90] {    polygon-fill: #B10026; }",
                      interactivity: "cartodb_id"}]
                    });
    var l_percent_foreignborn_choro_12 = new L.LayerGroup();
    percent_foreignborn_choro.addTo(l_percent_foreignborn_choro_12)
          .on('done', function(layer) {
          cdb.vis.Vis.addInfowindow(map_object, layer.getSubLayer(0), ['percent_fb_12', 'foreignbor', 'totalpop', 'cartodb_id'])
         });

var percent_nhasian_choro = cartodb.createLayer(map_object, {
                      user_name: 'andrewmartini',
                      type: 'cartodb',
                      sublayers: [{
                        sql: "SELECT totalpop, nhasian, cartodb_id, the_geom_webmercator, (nhasian/totalpop)*100 as percent_asian_12 FROM tract12 where totalpop > 100",
                        cartocss: "#layer{  polygon-fill: #fff;   polygon-opacity: 0;   line-color: #FFF;   line-width: 0;   line-opacity: 0; } #layer [ percent_asian_12 >= 10] {    polygon-fill: #FFFFB2;    polygon-opacity: 0.8;   line-color: #FFF;   line-width: 0.1;   line-opacity: 1; } #layer [ percent_asian_12 >= 20] {    polygon-fill: #FED976; } #layer [ percent_asian_12 >= 35] {    polygon-fill: #FEB24C; } #layer [ percent_asian_12 >= 50] {    polygon-fill: #FD8D3C; } #layer [ percent_asian_12 >= 65] {    polygon-fill: #FC4E2A; } #layer [ percent_asian_12 >= 80] {    polygon-fill: #E31A1C; } #layer [ percent_asian_12 >= 90] {    polygon-fill: #B10026; }",
                      interactivity: "cartodb_id"}]
                    });
    var l_percent_nhasian_choro_12 = new L.LayerGroup();
    percent_nhasian_choro.addTo(l_percent_nhasian_choro_12)
          .on('done', function(layer) {
          cdb.vis.Vis.addInfowindow(map_object, layer.getSubLayer(0), ['percent_asian_12', 'nhasian' ,'totalpop', 'cartodb_id'])
         });

var percent_hispanic_12_choro = cartodb.createLayer(map_object, {
                      user_name: 'andrewmartini',
                      type: 'cartodb',
                      sublayers: [{
                        sql: "SELECT cartodb_id, hispanic, totalpop, the_geom_webmercator, (hispanic/totalpop)*100 AS percent_hispanic_12 FROM tract12 where totalpop > 100",
                        cartocss: "#layer{  polygon-fill: #fff;   polygon-opacity: 0;   line-color: #FFF;   line-width: 0;   line-opacity: 0; } #layer [ percent_hispanic_12 >= 10] {    polygon-fill: #FFFfb2;    polygon-opacity: 0.8;   line-color: #FFF;   line-width: 0.1;   line-opacity: 1; } #layer [ percent_hispanic_12 >= 20] {    polygon-fill: #FED976; } #layer [ percent_hispanic_12 >= 35] {    polygon-fill: #FEB24C; } #layer [ percent_hispanic_12 >= 50] {    polygon-fill: #FD8D3C; } #layer [ percent_hispanic_12 >= 65] {    polygon-fill: #FC4E2A; } #layer [ percent_hispanic_12 >= 80] {    polygon-fill: #E31A1C; } #layer [ percent_hispanic_12 >= 90] {    polygon-fill: #B10026; }",
                      interactivity: "cartodb_id"}]
                    });
    var l_percent_hispanic_12_choro_12 = new L.LayerGroup();
    percent_hispanic_12_choro.addTo(l_percent_hispanic_12_choro_12)
          .on('done', function(layer) {
           cdb.vis.Vis.addInfowindow(map_object, layer.getSubLayer(0), ['percent_hispanic_12','hispanic', 'totalpop', 'cartodb_id'])
        });

var median_inc_to_rent = cartodb.createLayer(map_object, {
                      user_name: 'andrewmartini',
                      type: 'cartodb',
                      sublayers: [{
                        sql: "SELECT cartodb_id, medrenttoh, medianhhin, the_geom_webmercator FROM tract12 WHERE Totalpop > 250",
                        cartocss: "#layer{polygon-fill: #0080ff;polygon-opacity: 0.8;line-color: #FFF;line-width: 0.5;line-opacity: 1;}#layer [ medrenttoh <= 50] {polygon-fill: #ff4d4d;}#layer [ medrenttoh <= 44.6] {polygon-fill: #ff7a7a;}#layer [ medrenttoh <= 40.1] {polygon-fill: #ffa6a6;}#layer [ medrenttoh <= 35.6] {polygon-fill: #fff2cc;}#layer [ medrenttoh <= 31.1] {polygon-fill: #7fbfff;}#layer [ medrenttoh <= 26.6] {polygon-fill: #40a0ff;}#layer [ medrenttoh <= 22.1] {polygon-fill: #0080ff;}",
                        interactivity: "cartodb_id"}]
                    });
    var l_median_inc_to_rent_12 = new L.LayerGroup();
    median_inc_to_rent.addTo(l_median_inc_to_rent_12)
          .on('done', function(layer) {
           cdb.vis.Vis.addInfowindow(map_object, layer.getSubLayer(0), ['medrenttoh','medianhhin', 'cartodb_id'])
        });

var median_inc_choro = cartodb.createLayer(map_object, {
                      user_name: 'andrewmartini',
                      type: 'cartodb',
                      sublayers: [{
                        sql: "SELECT cartodb_id, the_geom_webmercator, medianhhin FROM tract12 WHERE Totalpop > 250",
                        cartocss: "#layer{ polygon-fill: #d73027;   polygon-opacity: 0.8;   line-color: #FFF;   line-width: 0.1;   line-opacity: 1; } #layer [ medianhhin <= 243622] { polygon-fill: #1a9850; } #layer [ medianhhin <= 84240] { polygon-fill: #8cce8a; } #layer [ medianhhin <= 67394] { polygon-fill: #d2ecb4; } #layer [ medianhhin <= 57176] { polygon-fill: #fff2cc; } #layer [ medianhhin <= 48159] { polygon-fill: #fed6b0; } #layer [ medianhhin <= 39538] { polygon-fill: #f79272; } #layer [ medianhhin <= 30106] { polygon-fill: #d73027; }",
                      interactivity: "cartodb_id"}]
                    });
    var l_median_inc_choro_12  = new L.LayerGroup();
    median_inc_choro.addTo(l_median_inc_choro_12)
           .on('done', function(layer) {
           cdb.vis.Vis.addInfowindow(map_object, layer.getSubLayer(0), ['medianhhin', 'cartodb_id'])
        });

// testing graduated cylinder size w/redundant code reduction using variables //
var ethnicity_props= "marker-fill-opacity: 0; marker-line-width: 0; marker-line-opacity: 0; marker-placement: point; marker-multi-policy: largest; marker-type: ellipse;  marker-allow-overlap: true; marker-clip: false; marker-comp-op: darken; ";
var redundantcode = "marker-fill-opacity: 0.7; marker-line-width: 2; marker-line-opacity: 1;";
var text_props = "text-face-name: 'Lato Bold'; text-size: 11; text-fill: #FFF; text-halo-radius: 1; text-halo-fill: #000; text-allow-overlap: true; text-placement: point; text-placement-type: simple; text-character-spacing: 1.1; text-label-position-tolerance: 20;";
  var size6css =  "marker-width: 27.0; "+redundantcode+" marker-fill-opacity: 0.9; ";   // n >=1001
  var size5css =  "marker-width: 20.0; "+redundantcode;   // 401 < n <=1000
  var size4css =  "marker-width: 14.0; "+redundantcode;   // 201 < n <=400
  var size3css =  "marker-width: 11.0; "+redundantcode;   // 51 < n <=200
  var size2css =  "marker-width: 7.5;  "+redundantcode;   // 21 < n <=50
  var size1css =  "marker-width: 4.0;  "+redundantcode;   // 6 < n <=20
  var size0css =  "marker-width: 0; marker-fill-opacity: 0; marker-line-width: 0; marker-line-opacity: 0;"; // n <=5

// color choices for individual groups
var bangladesh_color = "marker-fill: #5CA2D1; marker-line-color: #5CA2D1; ";
var pakistani_color = "marker-fill: #966B6B; marker-line-color: #966B6B; ";
var asianindia_color = "marker-fill: #e25043; marker-line-color: #e25043; ";
var arab_color = "marker-fill: #6fc98d; marker-line-color: #6fc98d; ";
var turkish_color = "marker-fill: #e0a8bf; marker-line-color: #e0a8bf; ";
var senegalese_color = "marker-fill: #0d697f; marker-line-color: #0d697f; ";

// ethnicity layers go below this line
var bangladesh_gradu_12 = cartodb.createLayer(map_object, {
                      user_name: 'andrewmartini',
                      type: 'cartodb',
                      sublayers: [{
                        sql: "SELECT the_geom, the_geom_webmercator, cartodb_id, fbbanglade, bangladesh FROM tract12 WHERE bangladesh > 5",
                        cartocss:  "#layer{ "+bangladesh_color+ethnicity_props+"} #layer [ bangladesh >= 1001] { "+size6css+" } #layer [ bangladesh <= 1000] { "+size5css+" } #layer [ bangladesh <= 400] { "+size4css+" } #layer [ bangladesh  <= 200] { "+size3css+" } #layer [ bangladesh <= 50] { "+size2css+"  } #layer [ bangladesh <= 20] { "+size1css+" } #layer [ bangladesh  <= 5] { "+size0css+"} #layer::labels [zoom >= 13] [bangladesh>= 400] { text-name: [bangladesh]; "+text_props+"}",
                      interactivity: "cartodb_id"}]
                    });
    var l_bangladesh_gradu_12  = new L.LayerGroup();
    bangladesh_gradu_12.addTo(l_bangladesh_gradu_12)
          .on('done', function(layer) {
          cdb.vis.Vis.addInfowindow(map_object, layer.getSubLayer(0), ['bangladesh', 'fbbanglade', 'cartodb_id'])
        });

var pakistani_gradu_12 = cartodb.createLayer(map_object, {
                      user_name: 'andrewmartini',
                      type: 'cartodb',
                      sublayers: [{
                        sql: "SELECT the_geom, the_geom_webmercator, cartodb_id, fbpakistan, pakistani FROM tract12 WHERE pakistani > 5",
                        cartocss:  "#layer{ "+pakistani_color+ethnicity_props+"} #layer [ pakistani >= 1001] { "+size6css+" } #layer [pakistani <= 1000] { "+size5css+" } #layer [pakistani <= 400] { "+size4css+" } #layer [ pakistani  <= 200] { "+size3css+" } #layer [pakistani <= 50] { "+size2css+"  } #layer [pakistani <= 20] { "+size1css+" } #layer [pakistani <= 5] { "+size0css+"} #layer::labels [zoom >= 13] [pakistani>= 400] {text-name: [pakistani]; "+text_props+"}",
                        interactivity: "cartodb_id"}]
                    });
    var l_pakistani_gradu_12  = new L.LayerGroup();
    pakistani_gradu_12.addTo(l_pakistani_gradu_12)
           .on('done', function(layer) {
           cdb.vis.Vis.addInfowindow(map_object, layer.getSubLayer(0), ['pakistani', 'fbpakistan', 'cartodb_id'])
        });

var asianindia_gradu_12 = cartodb.createLayer(map_object, {
                      user_name: 'andrewmartini',
                      type: 'cartodb',
                      sublayers: [{
                        sql: "SELECT the_geom, the_geom_webmercator, cartodb_id, asianindia, fbindia FROM tract12 WHERE asianindia > 5",
                        cartocss: "#layer{ "+asianindia_color+ethnicity_props+"} #layer [ asianindia >= 1001] { "+size6css+" }  #layer [ asianindia <= 1000] { "+size5css+" } #layer [ asianindia <= 400] { "+size4css+" } #layer [ asianindia  <= 200] { "+size3css+" } #layer [ asianindia <= 50] { "+size2css+"  } #layer [ asianindia <= 20] { "+size1css+" } #layer [ asianindia  <= 5] { "+size0css+"} #layer::labels [zoom >= 13] [asianindia>= 400] { text-name: [asianindia]; "+text_props+"}",
                       interactivity: "cartodb_id"}]
                    });
    var l_asianindia_gradu_12  = new L.LayerGroup();
    asianindia_gradu_12.addTo(l_asianindia_gradu_12)
          .on('done', function(layer) {
          cdb.vis.Vis.addInfowindow(map_object, layer.getSubLayer(0), ['asianindia', 'fbindia' , 'cartodb_id'])
         });

var arab_gradu_12 = cartodb.createLayer(map_object, {
                      user_name: 'andrewmartini',
                      type: 'cartodb',
                      sublayers: [{
                        sql: "SELECT the_geom, the_geom_webmercator, cartodb_id, arab, fbarab FROM tract12 WHERE arab > 5",
                        cartocss:  "#layer{  "+arab_color+ethnicity_props+"} #layer [ arab >= 1001] { "+size6css+" } #layer [ arab <= 1000] { "+size5css+" } #layer [ arab <= 400] { "+size4css+" } #layer [ arab  <= 200] { "+size3css+" } #layer [ arab <= 50] { "+size2css+"  } #layer [ arab <= 20] { "+size1css+" } #layer [ arab  <= 5] { "+size0css+"} #layer::labels [zoom >= 13] [arab>= 400] { text-name: [arab]; "+text_props+"}",
                        interactivity: "cartodb_id"}]
                    });
    var l_arab_gradu_12 = new L.LayerGroup();
    arab_gradu_12.addTo(l_arab_gradu_12)
          .on('done', function(layer) {
          cdb.vis.Vis.addInfowindow(map_object, layer.getSubLayer(0), ['arab', 'fbarab', 'cartodb_id'])
         });

var turkish_gradu_12 = cartodb.createLayer(map_object, {
                      user_name: 'andrewmartini',
                      type: 'cartodb',
                      sublayers: [{
                        sql: "SELECT the_geom, the_geom_webmercator, cartodb_id, turkish  FROM tract12 WHERE turkish > 5",
                        cartocss:  "#layer{  "+turkish_color+ethnicity_props+"} #layer [ turkish >= 1001] { "+size6css+" } #layer [ turkish <= 1000] { "+size5css+" } #layer [ turkish <= 400] { "+size4css+" } #layer [ turkish  <= 200] { "+size3css+" } #layer [ turkish <= 50] { "+size2css+"  } #layer [ turkish <= 20] { "+size1css+" } #layer [ turkish  <= 5] { "+size0css+"} #layer::labels [zoom >= 13] [turkish>= 400] { text-name: [turkish]; "+text_props+"}",
                        interactivity: "cartodb_id"}]
                    });
    var l_turkish_gradu_12  = new L.LayerGroup();
    turkish_gradu_12.addTo(l_turkish_gradu_12)
         .on('done', function(layer) {
         cdb.vis.Vis.addInfowindow(map_object, layer.getSubLayer(0), ['turkish',  'cartodb_id'])
         });

var senegalese_gradu_12 = cartodb.createLayer(map_object, {
                      user_name: 'andrewmartini',
                      type: 'cartodb',
                      sublayers: [{
                        sql: "SELECT the_geom, the_geom_webmercator, cartodb_id, senegalese, fbwafrica FROM tract12 WHERE senegalese > 5",
                        cartocss:  "#layer{  "+senegalese_color+ethnicity_props+"} #layer [ senegalese >= 1001] { "+size6css+" } #layer [ senegalese <= 1000] { "+size5css+" } #layer [ senegalese <= 400] { "+size4css+" } #layer [ senegalese  <= 200] { "+size3css+" } #layer [ senegalese <= 50] { "+size2css+"  } #layer [ senegalese <= 20] { "+size1css+" } #layer [ senegalese  <= 5] { "+size0css+"} #layer::labels [zoom >= 13] [senegalese>= 400] { text-name: [senegalese]; "+text_props+"}",
                        interactivity: "cartodb_id"}]
                    });
    var l_senegalese_gradu_12  = new L.LayerGroup();
    senegalese_gradu_12.addTo(l_senegalese_gradu_12)
          .on('done', function(layer) {
          cdb.vis.Vis.addInfowindow(map_object, layer.getSubLayer(0), ['senegalese', 'fbwafrica', 'cartodb_id'])
          });

// </> end ethnicity layers

var dot_bike_2015 = cartodb.createLayer(map_object, {
                      user_name: 'andrewmartini',
                      type: 'cartodb',
                      sublayers: [{
                        sql: "SELECT * FROM nyc_bike_routes_2015",
                        cartocss: "#nyc_bike_routes_2015 { line-opacity: 0.7; } #nyc_bike_routes_2015 [facilitycl='I'] { line-color: #055D00; line-width: 4; } #nyc_bike_routes_2015[facilitycl='II'] { line-color: #055D00; line-width: 3; } #nyc_bike_routes_2015[facilitycl='III'] { line-color: #229A00; line-width: 3; line-dasharray: 6,3; } #nyc_bike_routes_2015 { line-color: #fdbf6f;  line-width: 2;}",
                      interactivity: "cartodb_id"}]
                    });
    var l_dot_bike_2015 = new L.LayerGroup();
    dot_bike_2015.addTo(l_dot_bike_2015)
          .on('done', function(layer) {
          cdb.vis.Vis.addInfowindow(map_object, layer.getSubLayer(0), ['street', 'fromstreet', 'tostreet', 'tf_facilit', 'facilitycl', 'allclasses'])
         });


var rent_stabl = cartodb.createLayer(map_object, {
                      user_name: 'chenrick',
                      type: 'cartodb',
                      sublayers: [{
                        sql: "SELECT * FROM  public.all_nyc_likely_rent_stabl_merged",
                        cartocss: "#layer {polygon-fill: #BB75DC; polygon-opacity: 0.8; line-color: #FFF;line-width: 0.1;line-opacity: 0.7;}",
                      interactivity: "cartodb_id"}]
                    });
    var l_rent_stabl = new L.LayerGroup();
    rent_stabl.addTo(l_rent_stabl)
          .on('done', function(layer) {
          cdb.vis.Vis.addInfowindow(map_object, layer.getSubLayer(0), ['address', 'builtfar', 'landuse', 'numfloors'])
         });

 var num_floors = cartodb.createLayer(map_object, 'http://pluto.cartodb.com/api/v2/viz/0cd08e80-fee5-11e2-8888-ddc4604a078e/viz.json');
          var l_num_floors = new L.LayerGroup();
          num_floors.addTo(l_num_floors);

// initial layers
map_object.addLayer(l_nybb);
map_object.addLayer(l_neigh_labels);

    var baseMaps = [
                      {
                groupName : "Basemaps",
                expanded : false,
                layers    : {
                  "Gray"      :  light_nolabels,
                  "Satellite" :  Esri_WorldImagery,
                  "Streets"   :  OpenStreetMap_Mapnik,
                  "Mapquest streets" : MapQuestOpen_OSM,
                  "Relief"   :  Stamen_TerrainBackground,
                  "Acetate terrain" : Acetate_terrain,
                  "Black": black_wallpaper
                }
                      }
    ];

    var overlays = [
                {
                groupName : "Districts",
                expanded : false,
                layers    : {
                            "Boroughs": l_nybb,
                            "Neighborhoods": l_neighborhoods,
                            "Community Districts": l_nycd,
                            "City Council": l_nycc,
                            "NY State Senate": l_nyss,
                            "NY State Assembly": l_nyad,
                            "US Congressional": l_nycg,
                            "Police Precincts": l_precincts,
                            "Zip Codes": l_zipcode,
                            "Health Zones": l_uhf_health
                            }
                },
                {
                groupName : "Facilities",
                expanded : true,
                layers    : {
                            "<img src='css/images/protest.svg'  height='14px' width='14px'/> Community Based Orgs": l_cbo,
                            "<img src='css/images/school.png'  height='14px' width='14px'/> Schools": l_schools,
                            "<img src='css/images/Hospital_Sign_32.png'  height='14px' width='14px'/> Hospitals & Clinics": l_health,
                            "<img src='css/images/Open_book_32.png'  height='14px' width='14px'/> Libraries": l_library,
                            "<img src='css/images/Swimming_silhouette_32.png'  height='14px' width='14px'/> Senior & Rec Centers": l_fac,
                            "NYCHA developments": l_nycha,
                            "Subways": l_subways,
                            "Bike Lanes": l_dot_bike_2015,
                            "Parks": l_dpr_parks
                            }
                },
      {
                groupName : "Demographics",
                expanded : true,
                layers    : {
                           // "None": l_none,
                            "% Hispanic": l_percent_hispanic_12_choro_12,
                            "% White": l_percent_nhwhite_choro_12,
                            "% Black": l_percent_nhblack_choro_12,
                            "% Asian": l_percent_nhasian_choro_12
                            }
      },
      {
                groupName : "Income",
                expanded : true,
                layers    : {
                            "Median HH Income": l_median_inc_choro_12,
                            "Median Inc to Rent": l_median_inc_to_rent_12
                          }
      },
      {
                groupName : "Foreign Born",
                expanded : true,
                layers    : {
                            "% Foreign Born": l_percent_foreignborn_choro_12,
                            "<img src='css/images/circle-16-bangladesh.png' height='10px' width='10px'/> Bangladeshi": l_bangladesh_gradu_12,
                            "<img src='css/images/circle-16-pakistani.png' height='10px' width='10px'/> Pakistani": l_pakistani_gradu_12,
                            "<img src='css/images/circle-16-asianindia.png' height='10px' width='10px'/> Indian": l_asianindia_gradu_12,
                            "<img src='css/images/circle-16-arab.png' height='10px' width='10px'/> Arab": l_arab_gradu_12,
                            "<img src='css/images/circle-16-turkish.png' height='10px' width='10px'/> Turkish": l_turkish_gradu_12,
                            "<img src='css/images/circle-16-senegalese.png' height='10px' width='10px'/> Senegalese": l_senegalese_gradu_12
                              }
      },
      {
                groupName : "Labels",
                expanded : false,
                layers    : {
                            "Neighborhoods"       : l_neigh_labels,
                            "Gray Basemap Labels" : labels_overlay,
                            "Stamen Toner Labels" : Stamen_TonerLabels
                            }
      },
      {
                groupName : "Other",
                expanded : true,
                layers    : {
                            "Likely Rent Stabilized"       : l_rent_stabl,
                            "Building Heights"             : l_num_floors
                            }
      }
    ];

    // Make the "Demographics" group exclusive (use radio inputs)
   // var options = { exclusiveGroups: ["Demographics"], groupCheckboxes: false, collapsed: false, autoZIndex: false };

    // Use the custom grouped layer control, not "L.control.layers"
   // var layerControl = L.control.groupedLayers(baseLayers, groupedOverlays, options);
   // map_object.addControl(layerControl);

      var options = {
       // container_width   : "",
       // group_maxHeight     : "",
       // container_maxHeight : "",
        exclusive : false,  // true makes only one group able to be opened at a time!
        collapsed: false,
        autoZIndex: false
        //exclusive: ["Demographics"],   want to have radio check boxes here - may need to steal 'exclusive' code or make a basemap type
        //groupCheckboxes: true
      };

      var control = L.Control.styledLayerControl(baseMaps, overlays, options);
        map_object.addControl(control);

            }
  
  


        </script>
        

    </body>
</html>
